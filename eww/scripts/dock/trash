#!/bin/env bash
# ~/.config/eww/scripts/dock/trash-listen
set -euo pipefail

trash_dir="$HOME/.local/share/Trash/files"

# función que imprime la ruta correcta (una línea)
print_icon() {
  if compgen -G "$trash_dir/*" > /dev/null; then
    printf '%s\n' "$HOME/Downloads/Brave/trashf.png"
  else
    printf '%s\n' "$HOME/.local/share/icons/WhiteSur/apps/scalable/trash.svg"
  fi
}

# emitir estado inicial
print_icon

# requiere inotifywait (inotify-tools)
if ! command -v inotifywait >/dev/null 2>&1; then
  echo "ERROR: inotifywait no está instalado" >&2
  # salimos con el estado inicial (ya lo imprimimos)
  sleep 999999
fi

# escuchar cambios: create, delete, moved_to, moved_from en el directorio
inotifywait -m -e create -e delete -e moved_to -e moved_from --format '%e' "$trash_dir" 2>/dev/null \
| while read -r _evt; do
    # al primer evento, reimprimimos estado (Eww recibirá la línea y actualizará)
    print_icon
  done
